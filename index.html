<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>ç‰¹ãƒªãƒ—TVï½œæ–°ãƒãƒŠãƒ“ å°‚ç”¨ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼š2025.10.11ï¼‰</title>
<style>
  body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic","Meiryo",sans-serif;margin:24px;color:#111}
  h1{font-size:20px;margin:0 0 12px}
  .hint{background:#fff7ed;border:1px solid #fed7aa;color:#7c2d12;padding:8px 10px;border-radius:8px;font-size:13px}
  .error{background:#fef2f2;border:1px solid #fecaca;color:#991b1b;padding:8px 10px;border-radius:8px;font-size:13px;margin-top:8px;display:none}
  .card{background:#f9fafb;border:1px solid #e5e7eb;border-radius:10px;padding:12px;margin-top:12px}
  .card h3{margin:0 0 8px;font-size:14px}
  textarea{width:100%;height:200px;border:1px solid #e5e7eb;border-radius:8px;padding:8px;font-family:ui-monospace,SFMono-Regular,Menlo,monospace;font-size:12px}
  .grid{display:grid;grid-template-columns:1fr;gap:8px}
  @media(min-width:720px){.grid{grid-template-columns:1fr 1fr}}
  label span.key{width:150px;color:#374151;display:inline-block}
  input[type="number"]{border:1px solid #e5e7eb;border-radius:6px;padding:6px 8px;width:100%}
  .perg{font-size:11px;color:#6b7280;width:100px;text-align:right}
  .bar-wrap{width:100%;height:16px;background:#e5e7eb;border-radius:999px;overflow:hidden}
  .bar{height:16px;transition:width .3s ease}
  .rowline{display:flex;align-items:center;justify-content:space-between;font-size:12px;margin-bottom:4px}
  ul.log{margin:6px 0 0 18px;padding:0;font-size:12px;line-height:1.4}
  .opts{display:flex;gap:14px;align-items:center;font-size:13px;color:#374151;flex-wrap:wrap;margin-top:4px}
  .opts label{margin-right:8px;}
  .muted{color:#6b7280}
  .kv{display:flex;align-items:center;gap:8px}
  .secnote{font-size:12px;color:#6b7280;margin-top:4px}
  .pill{display:inline-block;background:#eef2ff;color:#3730a3;border-radius:999px;padding:2px 8px;font-size:11px}
  .two-col{display:grid;grid-template-columns:1fr;gap:10px}
  @media(min-width:1000px){.two-col{grid-template-columns:1fr 1fr}}
  .subgrid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  table{width:100%;border-collapse:collapse;font-size:12px}
  th,td{border:1px solid #e5e7eb;padding:6px 8px;text-align:left;vertical-align:top}
  th{background:#f3f4f6}
  .tag{display:inline-block;font-size:10px;padding:2px 6px;border-radius:6px;background:#f1f5f9;color:#0f172a;margin-left:6px}
</style>
</head>
<body>
<h1>ç‰¹ãƒªãƒ—TVï½œæ–°ãƒãƒŠãƒ“ å°‚ç”¨ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼š2025.10.11ï¼‰</h1>

<div class="card">
  <h3>æ©Ÿç¨®é¸æŠ</h3>
  <select id="machine-select">
    <option value="SHIN_HANABI">æ–°ãƒãƒŠãƒ“ å°‚ç”¨ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼š2025.10.11ï¼‰</option>
    </select>
</div>

<div class="hint">
  OCRå´©ã‚Œã«å¼·ã„æŠ½å‡ºï¼ˆ<b>è¡Œé€£çµ</b>â†’<b>è¿‘å‚Â±20è¡ŒÃ—åˆ†æ¯ãƒ¬ãƒ³ã‚¸</b>â†’å…¨ä½“ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ï¼‹<b>äºŒé …ãƒ­ã‚°å°¤åº¦</b>ã§è¨­å®šæ¯”è¼ƒã€‚<br>
  <b>ãƒ”ãƒ¼ã‚¹ãƒãƒ¼ã‚¯</b>ONã§ã€Œè¨­å®š1ï¼0%ã€ã€<b>äºˆå‘ŠéŸ³æ°·ãƒã‚ºãƒ¬</b>ONã§ã€Œè¨­å®š1ãƒ»2ï¼0%ã€ã€‚<br>
  <span style="color:#2563eb;">ğŸ’¡ æ¨å¥¨: OCRã‚¢ãƒ—ãƒªã§ãƒ†ã‚­ã‚¹ãƒˆåŒ–å¾Œã€<b>ã€RBä¸­ãƒã‚ºãƒ¬ï¼ˆå›ï¼‰ã€</b>ã‚’ãƒ¦ãƒ‹ãƒ¡ãƒ¢ã§ç¢ºèªã—ã€<b>ç·¨é›†ãƒ¢ãƒ¼ãƒ‰</b>ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</span>
  <small class="muted">â€»ã€Œæœªæ¤œå‡ºã€ã¯è©²å½“ãƒ©ãƒ™ãƒ«ã®è¿‘å‚ã«æœ‰åŠ¹ãªæ•°å€¤ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚</small>
</div>

<div id="err" class="error"></div>

<div class="card">
  <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
    <h3>ãƒ†ã‚­ã‚¹ãƒˆï¼ˆæ‰‹å‹•è²¼ã‚Šä»˜ã‘ï¼‰</h3>
    <div class="opts">
      <label class="kv"><input id="edit-mode" type="checkbox"> ç·¨é›†ãƒ¢ãƒ¼ãƒ‰</label>
      <label class="kv"><input id="peace" type="checkbox"> ãƒ”ãƒ¼ã‚¹ãƒãƒ¼ã‚¯å‡ºç¾</label>
      <label class="kv"><input id="yohaku-hazure" type="checkbox"> äºˆå‘ŠéŸ³æ°·ãƒã‚ºãƒ¬ï¼ˆè¨­å®š5ãƒ»6ç¢ºå®šï¼‰</label>
      <button id="btn-parse" class="btn" style="background:#2563eb;color:#fff;border:none;border-radius:8px;padding:6px 10px;">ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰è§£æ</button>
    </div>
  </div>
  <textarea id="text" placeholder="ç·ãƒ—ãƒ¬ã‚¤æ•°ï¼š6,056G
é¢¨éˆ´åˆç®—ï¼š813å› 1/7.4
ãƒã‚§ãƒªãƒ¼åˆç®—ï¼š393å› 1/15.4
æ°·åˆç®—ï¼š103å› 1/58.8"></textarea>
  <div class="secnote">â€»OCRã§ <code>ãƒã‚§ãƒªãƒ¼âåˆç®—</code> / <code>èŠ±ç«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ä¸­âã¯ãšã‚Œ</code> / <code>ç·ãƒ—ãƒ¬ã‚¤æ•°â6,056G</code> ãªã©ã®è¡Œå‰²ã‚Œã¯è‡ªå‹•çµåˆã—ã¾ã™ã€‚</div>
</div>

<div class="two-col">
  <div class="card">
    <h3>æŠ½å‡ºãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆç·¨é›†å¯ / ç·¨é›†ãƒ¢ãƒ¼ãƒ‰OFFã§å›ºå®šï¼‰</h3>
    <div class="grid" id="metrics"></div>
  </div>

  <div class="card">
    <h3>æŠ½å‡ºã‚·ã‚°ãƒŠãƒ«ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰</h3>
    <div class="subgrid">
      <div><span class="key">BBæ–œã‚é¢¨éˆ´</span><span id="sig-bb-slant" class="pill muted">æœªæ¤œå‡º</span></div>
      <div><span class="key">BBãƒ¬ã‚¢å½¹(ãƒãƒ©ã‚±ç›®)</span><span id="sig-bb-rare" class="pill muted">æœªæ¤œå‡º</span></div>
      <div><span class="key">HCã¯ãšã‚Œ</span><span id="sig-rt-hc" class="pill muted">æœªæ¤œå‡º</span></div>
      <div><span class="key">HGã¯ãšã‚Œ</span><span id="sig-rt-hg" class="pill muted">æœªæ¤œå‡º</span></div>
      <div style="grid-column: 1 / 3;"><span class="key">RBä¸­ãƒã‚ºãƒ¬ï¼ˆå›ï¼‰</span><span id="sig-rb-miss" class="pill muted">æœªæ¤œå‡ºï¼ˆæ‰‹å‹•ã§å›æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼‰</span></div>
      <div style="grid-column: 1 / 3;"><span class="key">äºˆå‘ŠéŸ³æ°·ï¼ˆãƒã‚ºãƒ¬ï¼‰</span><span id="sig-yohaku-hazure" class="pill muted">æœªæ¤œå‡º</span></div>
    </div>
  </div>
</div>

<div class="card">
  <h3>æŠ½å‡ºä¸€è¦§ï¼ˆå…¨é …ç›®ï¼‰<span class="tag">èª­ã¿å–ã‚Šå°‚ç”¨</span></h3>
  <table id="table-all">
    <thead><tr><th>é …ç›®</th><th>å›æ•°</th><th>åˆ†æ¯</th><th>å‚™è€ƒ</th></tr></thead>
    <tbody></tbody>
  </table>
</div>

<div class="card">
  <h3>æ¨æ¸¬æ¯”è¼ƒï¼ˆæœ€å¤§=èµ¤ã€æœ€å°=æ°´è‰²ï¼åŒå€¤ã¯ä¸­é–“è‰²ï¼‰</h3>
  <div id="bars">å¿…è¦ãªæ•°å€¤ãŒæƒã†ã¨æ¯”è¼ƒã‚°ãƒ©ãƒ•ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
</div>

<div class="card">
  <h3>æŠ½å‡ºãƒ­ã‚°</h3>
  <ul id="log" class="log"></ul>
</div>

<script>
/* === æ©Ÿç¨®åˆ¥ãƒ‡ãƒ¼ã‚¿å®šç¾© === */
const MACHINE_DATA = {
  "SHIN_HANABI": {
    displayName: "æ–°ãƒãƒŠãƒ“ å°‚ç”¨",
    // æœŸå¾…å€¤ (/G) â€” è¨­å®š: 1,2,5,6
    EXPECT: {
      bell:  [1/7.7,  1/7.6,  1/7.5,  1/7.3],
      cherry:[1/16.4, 1/15.3, 1/16.1, 1/15.6],
      ice:   [1/51.2, 1/51.8, 1/48.2, 1/49.3],
    },
    // åˆ†æ¯ãƒ¬ãƒ³ã‚¸
    RANGE: {
      bell:   [4.5, 10.5], cherry: [10, 25], ice: [35, 80],
      bb_slant:[7,  13], bb_rare: [400, 30000], rt_hc: [4.6, 6.6], rt_hg: [8.5, 14.5],
      bellA:[10,30], bellB:[10,30], iceA:[35,90], iceB:[300,5000],
      chA1:[80,140], chA2:[15,30], chB:[150,450], total_any:[2,5000],
      oneMedal:[8,25], yohakuIce:[10,40], bbFlat:[1.0,2.0],
    },
    // è¨­å®šåˆ¥æœŸå¾…åˆ†æ¯
    EXPECT_DENOM: {
      bb_slant: {1:11.0, 2:9.0, 5:11.0, 6:9.0},
      bb_rare:  {1:16384,2:16384,5:16384,6:655.4},
      rt_hc_miss:{1:6.0,  2:5.8,  5:5.3,  6:5.1},
      rt_hg_miss:{1:13.4, 2:12.4, 5:10.1, 6:9.5}
    },
    // é‡ã¿ (BBãƒ¬ã‚¢å½¹ã®é‡ã¿ã‚’0.5ã«ä¸‹ã’ã€ä»–ã®å°å½¹ã®å°¤åº¦ãŒå„ªå…ˆã•ã‚Œã‚‹ã‚ˆã†ã«èª¿æ•´)
    WEIGHTS: { bell:1.0, cherry:1.0, ice:0.7, bb_slant:1.1, bb_rare:0.5, rt_hc_miss:1.0, rt_hg_miss:1.0, rb_miss:1.6 },
    // è¨­å®šãƒªã‚¹ãƒˆ
    SETTINGS: [1, 2, 5, 6],
    // å‚™è€ƒ
    NOTES: {
      "ãƒ¬ã‚¢å½¹ï¼ˆãƒãƒ©ã‚±ç›®/BBä¸­ï¼‰": "BBä¸­ã®ãƒ™ãƒ«ã®å´©ã‚Œç›®",
      "1æšå½¹": "RBä¸­ã®1æšå½¹",
      "äºˆå‘ŠéŸ³æ°·": "RBä¸­ã®1æšå½¹å‘ŠçŸ¥ã§æ°·æƒã„",
      "äºˆå‘ŠéŸ³æ°·ï¼ˆãƒã‚ºãƒ¬ï¼‰": "RBä¸­ã®1æšå½¹å‘ŠçŸ¥ã§ãƒã‚ºãƒ¬ç›®ï¼ˆè¨­å®š5ãƒ»6ç¢ºå®šï¼‰"
    }
  }
};

let currentMachine = MACHINE_DATA.SHIN_HANABI;

const state = {
  // rb_miss_count ã‚’ metrics ã«è¿½åŠ ã—ã€æ‰‹å‹•å…¥åŠ›ã®å¯¾è±¡ã¨ã™ã‚‹
  metrics:{games:undefined,bell:undefined,cherry:undefined,ice:undefined,rb_miss_count:undefined}, 
  extra:{bb_slant_den:null, bb_rare_den:null, rt_hc_den:null, rt_hg_den:null},
  flags:{peace:false, edit:false, yohakuHazure:false},
  allItems:[],
  log:[]
};

/* ---------- Utils ---------- */
const $ = (id)=>document.getElementById(id);
function toNum(x){ if(x==null) return undefined; const n=Number(String(x).replace(/,/g,'')); return Number.isFinite(n)?n:undefined; }
function pushLog(msg){ state.log.push(msg); }
function setError(msg){ const e=$("err"); e.style.display=msg?"block":"none"; e.textContent=msg||""; }
function setText(id, s){ const el=$(id); el.textContent=s; el.classList.toggle("muted", s.includes("æœªæ¤œå‡º") || s==="â€”"); }

/* ã‚µãƒ‹ã‚¿ã‚¤ã‚º */
function sanitize(s){
  return (s||"")
    .replace(/[ï¼-ï¼™]/g, d=>String.fromCharCode(d.charCodeAt(0)-0xFEE0))
    .replace(/[ï¼Œ]/g, ",").replace(/[ï¼]/g, ".")
    .replace(/[ï¼š:]\s*/g, ": ")
    .replace(/[ã€€]/g, " ")
    .replace(/[ï¼]/g, "/")
    .replace(/\s+\/\s+/g, "/")
    .replace(/\s{2,}/g, " ")
    .trim();
}

/* ===== è¡Œé€£çµï¼ˆOCRã®è¦‹å‡ºã—å‰²ã‚Œä¿®æ­£ï¼‰ ===== */
function coalesceLines(lines){
  const out=[];
  for(let i=0;i<lines.length;i++){
    let cur=lines[i];
    // ç·ãƒ—ãƒ¬ã‚¤æ•°/G é€£çµ
    if(/^(ç·ãƒ—ãƒ¬ã‚¤æ•°|ç·å›è»¢æ•°|ãƒ—ãƒ¬ã‚¤G|ç·ã‚²ãƒ¼ãƒ æ•°)\s*$/.test(cur) && i+1<lines.length && /^[0-9,]+\s*G\s*$/i.test(lines[i+1])){
        out.push(lines[i+1]); i++; continue; 
    }
    // å°å½¹ åˆç®— é€£çµ
    if(/^(é¢¨éˆ´|ãƒã‚§ãƒªãƒ¼|æ°·|ãƒã‚¨ãƒª)\s*$/.test(cur) && i+1<lines.length && /^(åˆç®—|åˆè¨ˆ|å…¨)\s*$/.test(lines[i+1])){
      out.push(RegExp.$1 + "åˆç®—"); i++; continue;
    }
    // èŠ±ç«ãƒãƒ£ãƒ¬ãƒ³ã‚¸/GAMEä¸­ ã¯ãšã‚Œ é€£çµ
    if(/^èŠ±ç«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ä¸­\s*$/.test(cur) && i+1<lines.length && /^(?:ã¯ãšã‚Œ|ãƒã‚ºãƒ¬|ãƒã‚ºãƒ¬ç›®|ã¯ãšã„|æ­³æœº)\s*$/.test(lines[i+1])){
      out.push("èŠ±ç«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ä¸­ã¯ãšã‚Œ"); i++; continue;
    }
    if(/^èŠ±ç«GAMEä¸­\s*$/.test(cur) && i+1<lines.length && /^(?:ã¯ãšã‚Œ|ãƒã‚ºãƒ¬|ãƒã‚ºãƒ¬ç›®|ã¯ãšã„|æ­³æœº)\s*$/.test(lines[i+1])){
      out.push("èŠ±ç«GAMEä¸­ã¯ãšã‚Œ"); i++; continue;
    }
    // ãƒ¬ã‚¢å½¹ï¼ˆãƒãƒ©ã‚±ç›®ï¼‰é€£çµ
    if(/^ãƒ¬ã‚¢å½¹\s*$/.test(cur) && i+1<lines.length && /[()ï¼ˆ].*ãƒãƒ©ã‚±ç›®.*[)ï¼‰]\s*$/.test(lines[i+1])){
      out.push("ãƒ¬ã‚¢å½¹ï¼ˆãƒãƒ©ã‚±ç›®ï¼‰"); i++; continue;
    }
    out.push(cur);
  }
  return out;
}

/* ãƒ‘ã‚¿ãƒ¼ãƒ³ */
const RE_G_ONLY   = /^\s*([0-9]{1,3}(?:,[0-9]{3})*)\s*G\s*$/i;
const RE_KAI_LIKE = /^\s*([0-9]{1,3}(?:,[0-9]{3})*)\s*(?:å›|å›˜|é—®|n|æ›°|æ—¥)?\s*$/i; // OCRèª¤èªè­˜å¯¾å¿œ
// ã€é‡è¦ä¿®æ­£ã€‘ã‚¹ãƒ©ãƒƒã‚·ãƒ¥/ç¸¦æ£’/ãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã®èª¤èªè­˜å¯¾å¿œ
const RE_FRAC_ANY = /[1Iï½Œl]\s*[\/\\à¥¤]\s*([0-9][0-9,]*(?:\.[0-9]+)?)/; 

function countFrac(line){
  const c=line.match(RE_KAI_LIKE);
  const f=line.match(RE_FRAC_ANY);
  const denom=f?parseFloat(f[1].replace(/,/g,'')):undefined;
  return { count:c?toNum(c[1]):undefined, denom };
}

/* æ–‡æ›¸å…¨ä½“ã®ã€Œå›+1/â—¯ã€å€™è£œ */
function collectAllPairs(lines){
  const pairs=[];
  for(let i=0;i<lines.length;i++){
    const {count,denom}=countFrac(lines[i]);
    if(count!=null && denom!=null){ pairs.push({idx:i,count,denom}); continue; }
    const c=lines[i].match(RE_KAI_LIKE);
    const f=(i+1<lines.length)?lines[i+1].match(RE_FRAC_ANY):null;
    // å›æ•°ã®ã¿ã®è¡Œã®æ¬¡ã« 1/â—¯ ãŒæ¥ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³
    if(c && f){ pairs.push({idx:i,count:toNum(c[1]),denom:parseFloat(f[1].replace(/,/g,''))}); i++; }
  }
  pushLog(`pairs: ${pairs.length}ä»¶åé›†`);
  return pairs;
}

/* è¿‘å‚æ¢ç´¢ï¼ˆÂ±20è¡Œï¼‰ */
function pickNearBy(lines, labelIdx, window, range){
  if(labelIdx<0) return null;
  const [lo,hi]=range;
  let best=null, bestDist=1e9;
  for(let j=Math.max(0,labelIdx-window); j<Math.min(lines.length,labelIdx+window+1); j++){
    const {count,denom}=countFrac(lines[j]);
    // 1è¡Œã«ã€Œå›ã€ã¨ã€Œ1/â—¯ã€ãŒã‚ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³
    if(count!=null && Number.isFinite(denom) && denom>=lo && denom<=hi){
      const dist=Math.abs(j-labelIdx);
      if(dist<bestDist){ best={count,denom,idx:j}; bestDist=dist; }
    }else{
      const c=lines[j].match(RE_KAI_LIKE);
      const f=(j+1<lines.length)?lines[j+1].match(RE_FRAC_ANY):null;
      // ã€Œå›ã€ã¨ã€Œ1/â—¯ã€ãŒ2è¡Œã«åˆ†ã‹ã‚Œã¦ã„ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³
      if(c && f){
        const cnt=toNum(c[1]); const den=parseFloat(f[1].replace(/,/g,''));
        if(cnt!=null && Number.isFinite(den) && den>=lo && den<=hi){
          const dist=Math.abs(j-labelIdx);
          if(dist<bestDist){ best={count:cnt,denom:den,idx:j}; bestDist=dist; }
        }
      }
    }
  }
  return best;
}

/* ãƒ©ãƒ™ãƒ«â†’è¿‘å‚â†’å…¨ä½“ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ */
function resolveMetric(lines, labelRegex, range, labelName, globalPairs){
  const idx=lines.findIndex(l=>labelRegex.test(l));
  let got=pickNearBy(lines, idx, 20, range);
  if(!got){
    const [lo,hi]=range;
    const expects = currentMachine.EXPECT[labelName]?.map(v=>1/v) ?? [];
    let best=null, bestScore=Infinity;
    for(const p of globalPairs){
      if(p.denom<lo || p.denom>hi) continue;
      const d = expects.length? Math.min(...expects.map(ex=>Math.abs(ex - p.denom))) : 0;
      // æœŸå¾…å€¤ã‹ã‚‰ã®ã‚ºãƒ¬ + å…ƒã®è¡Œã‹ã‚‰ã®è·é›¢
      const score = d + 0.0001*Math.abs((idx>=0?idx:p.idx)-p.idx);
      if(score<bestScore){ best=p; bestScore=score; }
    }
    got=best||null;
    if(got) pushLog(`${labelName||'é …ç›®'}: fallbackæ¡ç”¨ idx=${got.idx} â†’ ${got.count??'-'}å› (1/${got.denom??'-'})`);
  }else{
    pushLog(`${labelName||'é …ç›®'}: è¿‘å‚æ¡ç”¨ idx=${got.idx} â†’ ${got.count??'-'}å› (1/${got.denom??'-'})`);
  }
  return got;
}

/* === è§£ææœ¬ä½“ === */
function parseMetricsFromText(raw){
  state.log = [];
  state.allItems = [];
  const t = sanitize(raw);
  const rawLines = t.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  const lines = coalesceLines(rawLines);

  // metricsã‚’åˆæœŸåŒ– (rb_miss_countã¯æ‰‹å‹•å…¥åŠ›ã‚’æ´»ã‹ã™ãŸã‚ã€undefinedã®ã¿ã‚»ãƒƒãƒˆ)
  const out = {games:undefined,bell:undefined,cherry:undefined,ice:undefined,rb_miss_count:undefined}; 
  const extra = {bb_slant_den:null, bb_rare_den:null, rt_hc_den:null, rt_hg_den:null};

  // ç·Gï¼šG-onlyæœ€å¤§
  const cands = lines.map(ln=>{ const m=RE_G_ONLY.exec(ln); return m?toNum(m[1]):null; }).filter(v=>v!=null);
  if(cands.length){ out.games = Math.max(...cands); pushLog(`ç·G: G-onlyæœ€å¤§ â†’ ${out.games}`); } else pushLog("ç·G: è¦‹ã¤ã‹ã‚‰ãš");

  const allPairs = collectAllPairs(lines);

  // åˆç®—3ç¨® (OCRèª¤èªè­˜ãƒ‘ã‚¿ãƒ¼ãƒ³è¿½åŠ )
  const bell   = resolveMetric(lines, /é¢¨éˆ´\s*(?:åˆç®—|åˆè¨ˆ|å…¨)/, currentMachine.RANGE.bell,   "bell",   allPairs);
  const cherry = resolveMetric(lines, /ãƒã‚§ãƒªãƒ¼\s*(?:åˆç®—|åˆè¨ˆ|å…¨|ãƒã‚¨ãƒª)/, currentMachine.RANGE.cherry, "cherry", allPairs);
  const ice    = resolveMetric(lines, /æ°·\s*(?:åˆç®—|åˆè¨ˆ|å…¨)/,    currentMachine.RANGE.ice,    "ice",    allPairs);

  if(bell){ out.bell=bell.count; addItem("é¢¨éˆ´åˆç®—", bell.count, bell.denom); }
  if(cherry){ out.cherry=cherry.count; addItem("ãƒã‚§ãƒªãƒ¼åˆç®—", cherry.count, cherry.denom); }
  if(ice){ out.ice=ice.count; addItem("æ°·åˆç®—", ice.count, ice.denom); }

  // è¿½åŠ ã‚·ã‚°ãƒŠãƒ«ï¼ˆè¿‘å‚ï¼‰
  const bbSlant = pickNearBy(lines, lines.findIndex(l=>/(é¢¨æ–œã‚æƒã„|æ–œã‚é¢¨éˆ´|é¢¨éˆ´B|é¢¨æ–œã‚æƒ|é¢¨éˆ´æ–œã‚æƒ)/.test(l)), 20, currentMachine.RANGE.bb_slant);
  if(bbSlant){ extra.bb_slant_den = bbSlant.denom; addItem("é¢¨æ–œã‚æƒã„ï¼ˆBBä¸­ï¼‰", bbSlant.count, bbSlant.denom); }
  const bbFlat = pickNearBy(lines, lines.findIndex(l=>/(é¢¨éˆ´ä¸­æ®µæƒ)/.test(l)), 20, currentMachine.RANGE.bbFlat);
  if(bbFlat){ addItem("é¢¨éˆ´ä¸­æ®µæƒï¼ˆBBä¸­ï¼‰", bbFlat.count, bbFlat.denom); }
  const bbRare = pickNearBy(lines, lines.findIndex(l=>/(ãƒ¬ã‚¢å½¹|ãƒãƒ©ã‚±ç›®|ãƒ¬ã‚¢)/.test(l)), 20, currentMachine.RANGE.bb_rare);
  if(bbRare){ extra.bb_rare_den = bbRare.denom; addItem("ãƒ¬ã‚¢å½¹ï¼ˆãƒãƒ©ã‚±ç›®/BBä¸­ï¼‰", bbRare.count, bbRare.denom); }
  const rtHC = pickNearBy(lines, lines.findIndex(l=>/èŠ±ç«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ä¸­ã¯ãšã‚Œ/.test(l)), 20, currentMachine.RANGE.rt_hc);
  if(rtHC){ extra.rt_hc_den = rtHC.denom; addItem("èŠ±ç«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ä¸­ã¯ãšã‚Œ", rtHC.count, rtHC.denom); }
  const rtHG = pickNearBy(lines, lines.findIndex(l=>/èŠ±ç«GAMEä¸­ã¯ãšã‚Œ/.test(l)), 20, currentMachine.RANGE.rt_hg);
  if(rtHG){ extra.rt_hg_den = rtHG.denom; addItem("èŠ±ç«GAMEä¸­ã¯ãšã‚Œ", rtHG.count, rtHG.denom); }

  // RBä¸­ãƒã‚ºãƒ¬: è‡ªå‹•æŠ½å‡ºãƒ­ã‚¸ãƒƒã‚¯ã‚’å‰Šé™¤ï¼ˆæ‰‹å‹•å…¥åŠ›ã«ä¾å­˜ï¼‰
  // out.rb_miss_count ã¯ undefined ã®ã¾ã¾ã€‚æ‰‹å‹•å…¥åŠ›ã¯ renderMetrics ã§å‡¦ç†ã•ã‚Œã‚‹ã€‚
  // ãŸã ã—ã€allItemsã«ã¯æ‰‹å‹•å…¥åŠ›ç”¨ã®é …ç›®ã‚’æœ€åˆã«è¿½åŠ ã—ã¦ãŠã
  if(!Number.isFinite(state.metrics.rb_miss_count)){
    addItem("RBä¸­ãƒã‚ºãƒ¬", state.metrics.rb_miss_count, null);
  }

  // å†…è¨³ï¼ˆA/Bç­‰ï¼‰
  addByLabel(lines, /é¢¨éˆ´A/, "é¢¨éˆ´A", currentMachine.RANGE.bellA);
  addByLabel(lines, /é¢¨éˆ´B/, "é¢¨éˆ´B", currentMachine.RANGE.bellB);
  addByLabel(lines, /æ°·A/,   "æ°·A",   currentMachine.RANGE.iceA);
  addByLabel(lines, /æ°·B/,   "æ°·B",   currentMachine.RANGE.iceB);
  addByLabel(lines, /ãƒã‚§ãƒªãƒ¼A1/, "ãƒã‚§ãƒªãƒ¼A1", currentMachine.RANGE.chA1);
  addByLabel(lines, /ãƒã‚§ãƒªãƒ¼A2/, "ãƒã‚§ãƒªãƒ¼A2", currentMachine.RANGE.chA2);
  addByLabel(lines, /ãƒã‚§ãƒªãƒ¼B/,  "ãƒã‚§ãƒªãƒ¼B",  currentMachine.RANGE.chB);

  // ç·ãƒœãƒ¼ãƒŠã‚¹ç³» (OCRèª¤èªè­˜ãƒ‘ã‚¿ãƒ¼ãƒ³è¿½åŠ )
  addByLabel(lines, /ç·ãƒœãƒ¼ãƒŠã‚¹|ç·æœ¯ä¸€åã„¡|ç·ãƒœä¸€åã‚¹/, "ç·ãƒœãƒ¼ãƒŠã‚¹", currentMachine.RANGE.total_any);
  addByLabel(lines, /ç·BB|åˆè¨ˆBB|BBåˆè¨ˆ|ç¶ŒBB|FyBB/, "ç·BB", currentMachine.RANGE.total_any);
  addByLabel(lines, /ãƒ‰ãƒ³BB|FyBB/, "ãƒ‰ãƒ³BB", currentMachine.RANGE.total_any);
  addByLabel(lines, /èµ¤ä¸ƒBB|èµ¤ï¼—BB/, "èµ¤ä¸ƒBB", currentMachine.RANGE.total_any);
  addByLabel(lines, /RB\b|REG\b|ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ãƒœãƒ¼ãƒŠã‚¹|R B/, "RB", currentMachine.RANGE.total_any);

  // 1æšå½¹ï¼äºˆå‘ŠéŸ³æ°·
  addByLabel(lines, /1æšå½¹/, "1æšå½¹", currentMachine.RANGE.oneMedal);
  addByLabel(lines, /äºˆå‘ŠéŸ³æ°·/, "äºˆå‘ŠéŸ³æ°·", currentMachine.RANGE.yohakuIce);

  // ãƒ•ãƒ©ã‚°ï¼ˆäºˆå‘ŠéŸ³æ°·ãƒã‚ºãƒ¬ï¼‰ã‚’ä¸€è¦§ã«ã‚‚æ˜ç¤º
  if(state.flags.yohakuHazure){
    addItem("äºˆå‘ŠéŸ³æ°·ï¼ˆãƒã‚ºãƒ¬ï¼‰", null, null);
  }

  state.extra = extra;
  updateSignals(extra);
  pushLog(`summary: bell=${out.bell??"-"} | cherry=${out.cherry??"-"} | ice=${out.ice??"-"} | bb_slant=1/${extra.bb_slant_den??"-"} | bb_rare=1/${extra.bb_rare_den??"-"} | hc=1/${extra.rt_hc_den??"-"} | hg=1/${extra.rt_hg_den??"-"} | rb_miss=${state.metrics.rb_miss_count??"-"}`);
  renderAllTable();
  // out ã«ã¯ rb_miss_count ã¯ undefined ã®ãŸã‚ã€æ—¢å­˜ã® state.metrics.rb_miss_count ã®å€¤ã‚’ä½¿ã†ãŸã‚ã« out ã¯ä¸€éƒ¨ã®ã¿è¿”ã™
  return {games:out.games, bell:out.bell, cherry:out.cherry, ice:out.ice};

  function addItem(name, count, denom){
    state.allItems.push({name, count: (Number.isFinite(count)? count : null), denom: (Number.isFinite(denom)? denom : null)});
  }
  function addByLabel(lines, labelRe, labelName, range){
    const got = resolveMetric(lines, labelRe, range, null, allPairs);
    if(got) addItem(labelName, got.count, got.denom);
  }
}

/* ---------- æ¨æ¸¬ï¼ˆå°¤åº¦ãƒ™ãƒ¼ã‚¹ï¼šäºŒé …ãƒ­ã‚°å°¤åº¦ + è¿½åŠ æŒ‡æ¨™ã®ã‚¬ã‚¦ã‚¹ç½°å‰‡ï¼‰ ---------- */
function estimateAllSettings(m){
  const g = toNum(m.games)||0; if(!g) return [];
  const EPS=1e-9, clamp01=(p)=>Math.min(1-EPS,Math.max(EPS,p));
  const ll_binom=(k,n,p)=>{p=clamp01(p); const q=1-p; return k*Math.log(p)+(n-k)*Math.log(q);};
  const penalty_denom=(d,exp,w)=>(!Number.isFinite(d)||!Number.isFinite(exp))?0:(-w*Math.pow((d-exp)/exp,2)/(2*Math.pow(0.12,2)));

  const have={bell:Number.isFinite(toNum(m.bell)),cherry:Number.isFinite(toNum(m.cherry)),ice:Number.isFinite(toNum(m.ice))};
  const settings=currentMachine.SETTINGS;
  const rows=settings.map((s,i)=>{
    let ll=0, used=0;
    // å…±é€šå°å½¹
    if(have.bell){ ll+=currentMachine.WEIGHTS.bell*ll_binom(toNum(m.bell), g, currentMachine.EXPECT.bell[i]); used++; }
    if(have.cherry){ ll+=currentMachine.WEIGHTS.cherry*ll_binom(toNum(m.cherry), g, currentMachine.EXPECT.cherry[i]); used++; }
    if(have.ice){ ll+=currentMachine.WEIGHTS.ice*ll_binom(toNum(m.ice), g, currentMachine.EXPECT.ice[i]); used++; }
    
    // è¿½åŠ æŒ‡æ¨™ (åˆ†æ¯ãƒ™ãƒ¼ã‚¹)
    if(state.extra.bb_slant_den){ ll+=penalty_denom(state.extra.bb_slant_den, currentMachine.EXPECT_DENOM.bb_slant[s], currentMachine.WEIGHTS.bb_slant); used++; }
    if(state.extra.bb_rare_den){ ll+=penalty_denom(state.extra.bb_rare_den, currentMachine.EXPECT_DENOM.bb_rare[s], currentMachine.WEIGHTS.bb_rare); used++; }
    if(state.extra.rt_hc_den){ ll+=penalty_denom(state.extra.rt_hc_den, currentMachine.EXPECT_DENOM.rt_hc_miss[s], currentMachine.WEIGHTS.rt_hc_miss); used++; }
    if(state.extra.rt_hg_den){ ll+=penalty_denom(state.extra.rt_hg_den, currentMachine.EXPECT_DENOM.rt_hg_miss[s], currentMachine.WEIGHTS.rt_hg_miss); used++; }
    
    // RBä¸­ãƒã‚ºãƒ¬ (æ‰‹å‹•å…¥åŠ›ã®å€¤ã‚’ä½¿ç”¨)
    if(Number.isFinite(toNum(m.rb_miss_count))){
      const miss=toNum(m.rb_miss_count);
      // RBä¸­ãƒã‚ºãƒ¬ãŒ0å›ã®å ´åˆã€è¨­å®š5,6ã«ãƒœãƒ¼ãƒŠã‚¹
      if(miss===0){ 
        if(s===5||s===6){ ll += currentMachine.WEIGHTS.rb_miss*1.5; used++; }
      }
      // RBä¸­ãƒã‚ºãƒ¬ãŒ1å›ä»¥ä¸Šã®å ´åˆã€è¨­å®š1,2ã«ç½°å‰‡
      else if(miss>0){ 
        if(s===1||s===2){ ll -= currentMachine.WEIGHTS.rb_miss*(1+miss); used++; }
        if(s===5||s===6){ ll += currentMachine.WEIGHTS.rb_miss*Math.min(1,miss*0.2); used++; }
      }
    }
    
    // è¿½åŠ åˆ¶ç´„ (ãƒ•ãƒ©ã‚°)
    if(s===1 && state.flags.peace){ ll = -Infinity; used++; }           // ãƒ”ãƒ¼ã‚¹ â†’ è¨­å®š1ç¦æ­¢
    if((s===1||s===2) && state.flags.yohakuHazure){ ll = -Infinity; used++; } // äºˆå‘ŠéŸ³æ°·ãƒã‚ºãƒ¬ â†’ 1ãƒ»2ç¦æ­¢
    
    return {setting:s, ll: used? ll : -Infinity};
  });

  const maxLL=Math.max(...rows.map(r=>r.ll));
  const expS=rows.map(r=>Math.exp(r.ll-maxLL));
  const sumS=expS.reduce((a,b)=>a+b,0)||1;
  return rows.map((r,i)=>({setting:r.setting, score:expS[i], percent:(expS[i]/sumS)*100}));
}

/* ---------- UI ---------- */
function barColor(p,max,min){
  if(max===min) return "rgba(96,165,250,0.85)";
  if(p===max) return "rgba(239,68,68,0.85)";
  if(p===min) return "rgba(147,197,253,0.85)";
  const t=(p-min)/Math.max(1,(max-min));
  const r=Math.round(147+(59-147)*t), g=Math.round(197+(130-197)*t), b=Math.round(253+(246-253)*t);
  return `rgba(${r},${g},${b},0.9)`;
}
function renderBars(){
  const mount=$("bars");
  const rows=estimateAllSettings(state.metrics);
  if(!rows.length){ mount.textContent="å¿…è¦ãªæ•°å€¤ãŒæƒã†ã¨æ¯”è¼ƒã‚°ãƒ©ãƒ•ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚"; return; }
  const perc=rows.map(r=>r.percent), max=Math.max(...perc), min=Math.min(...perc);
  mount.innerHTML="";
  rows.forEach(r=>{
    const head=document.createElement("div"); head.className="rowline";
    head.innerHTML=`<span>${currentMachine.displayName}ï½œè¨­å®š${r.setting}</span><span>${r.percent.toFixed(2)}%</span>`;
    const barWrap=document.createElement("div"); barWrap.className="bar-wrap";
    const bar=document.createElement("div"); bar.className="bar";
    bar.style.width = Math.max(0, Math.min(100, isFinite(r.percent)? r.percent : 0)) + "%";
    bar.style.background = barColor(r.percent,max,min);
    barWrap.appendChild(bar);
    mount.appendChild(head); mount.appendChild(barWrap);
  });
}
function updateSignals(ex){
  setText("sig-bb-slant", ex.bb_slant_den? `1/${ex.bb_slant_den}` : "æœªæ¤œå‡º");
  setText("sig-bb-rare",  ex.bb_rare_den ? `1/${ex.bb_rare_den}`  : "æœªæ¤œå‡º");
  setText("sig-rt-hc",    ex.rt_hc_den   ? `1/${ex.rt_hc_den}`    : "æœªæ¤œå‡º");
  setText("sig-rt-hg",    ex.rt_hg_den   ? `1/${ex.rt_hg_den}`    : "æœªæ¤œå‡º");
  const rbMissCount = toNum(state.metrics.rb_miss_count);
  setText("sig-rb-miss",  Number.isFinite(rbMissCount)? `${rbMissCount}å› (æ‰‹å‹•å…¥åŠ›)` : "æœªæ¤œå‡ºï¼ˆæ‰‹å‹•ã§å›æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼‰");
  setText("sig-yohaku-hazure", state.flags.yohakuHazure? "ãƒã‚§ãƒƒã‚¯ONï¼ˆè¨­å®š1ãƒ»2=0%ï¼‰" : "æœªæ¤œå‡º");
}

const METRIC_KEYS=["games","bell","cherry","ice","rb_miss_count"];
const METRIC_LABEL={games:"ç·G", bell:"é¢¨éˆ´åˆç®—ï¼ˆå›ï¼‰", cherry:"ãƒã‚§ãƒªãƒ¼åˆç®—ï¼ˆå›ï¼‰", ice:"æ°·åˆç®—ï¼ˆå›ï¼‰", rb_miss_count:"RBä¸­ãƒã‚ºãƒ¬ï¼ˆå›ï¼‰"};
function renderMetrics(firstRender=false){
  const wrap=$("metrics");
  if(firstRender){
    wrap.innerHTML="";
    METRIC_KEYS.forEach(k=>{
      const row=document.createElement("label"); row.style.display="flex"; row.style.alignItems="center"; row.style.gap="8px";
      const keySpan=document.createElement("span"); keySpan.className="key"; keySpan.textContent=METRIC_LABEL[k]; row.appendChild(keySpan);
      const input=document.createElement("input"); input.type="number"; input.step="1"; input.id=`inp-${k}`;
      input.value = state.metrics[k]??"";
      input.oninput=(e)=>{
        if(!state.flags.edit) return;
        const v = e.target.value==="" ? undefined : toNum(e.target.value);
        state.metrics[k]=v;
        renderBars();
        updatePerG(k);
        // RBä¸­ãƒã‚ºãƒ¬ã®å…¥åŠ›ãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰ã‚·ã‚°ãƒŠãƒ«ã‚‚æ›´æ–°
        if(k === "rb_miss_count") updateSignals(state.extra);
      };
      input.onblur=()=>{ renderMetrics(false); };
      row.appendChild(input);
      const tail=document.createElement("span"); tail.className="perg"; tail.id=`perg-${k}`; row.appendChild(tail);
      wrap.appendChild(row);
    });
  }
  METRIC_KEYS.forEach(k=>{
    const input=$(`inp-${k}`);
    if(document.activeElement!==input){ input.value = state.metrics[k]??""; }
    input.disabled = !state.flags.edit;
    updatePerG(k);
  });

  const ul = $("log"); ul.innerHTML = "";
  state.log.slice(-30).forEach(msg=>{ const li=document.createElement("li"); li.textContent=msg; ul.appendChild(li); });
}
function updatePerG(k){
  const span=$(`perg-${k}`);
  if(k!=="games" && k!=="rb_miss_count" && toNum(state.metrics.games)){
    const per=(toNum(state.metrics[k])||0)/toNum(state.metrics.games);
    span.textContent = Number.isFinite(per) ? "/G "+per.toFixed(4) : "";
  }else span.textContent="";
}

function renderAllTable(){
  const tb = $("table-all").querySelector("tbody");
  tb.innerHTML = "";
  const rows = state.allItems;
  if(!rows.length){
    const tr = document.createElement("tr");
    tr.innerHTML = `<td colspan="4" class="muted">æŠ½å‡ºã§ããŸé …ç›®ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</td>`;
    tb.appendChild(tr);
    return;
  }
  rows.forEach(r=>{
    const tr = document.createElement("tr");
    const note = currentMachine.NOTES[r.name] || "";
    tr.innerHTML = `<td>${r.name}</td>
      <td>${Number.isFinite(r.count)? r.count : "â€”"}</td>
      <td>${Number.isFinite(r.denom)? "1/"+r.denom.toFixed(2) : "â€”"}</td>
      <td>${note||"â€”"}</td>`;
    tb.appendChild(tr);
  });
}

function loadMachine(machineKey) {
    currentMachine = MACHINE_DATA[machineKey];
    if (!currentMachine) {
        setError(`æ©Ÿç¨®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${machineKey}`);
        return;
    }
    // æ©Ÿç¨®å/ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
    $("machine-select").value = machineKey;
    document.querySelector('h1').textContent = `ç‰¹ãƒªãƒ—TVï½œ${currentMachine.displayName}ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼š2025.10.11ï¼‰`;
    
    // ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¦å†æç”»
    state.metrics={games:undefined,bell:undefined,cherry:undefined,ice:undefined,rb_miss_count:undefined};
    state.extra={bb_slant_den:null, bb_rare_den:null, rt_hc_den:null, rt_hg_den:null};
    state.allItems=[];
    
    renderMetrics(true); // metrics UIã‚’åˆæœŸåŒ–
    renderAllTable();
    renderBars();
    updateSignals(state.extra);
}

/* ---------- init ---------- */
function init(){
  loadMachine("SHIN_HANABI"); // åˆæœŸæ©Ÿç¨®ãƒ­ãƒ¼ãƒ‰
  
  // æ©Ÿç¨®é¸æŠãƒãƒ³ãƒ‰ãƒ©
  $("machine-select").addEventListener("change",(e)=>{
      loadMachine(e.target.value);
  });

  $("btn-parse").addEventListener("click", ()=>{
    try{
      setError("");
      // parseMetricsFromTextã®çµæœã‚’state.metricsã«ãƒãƒ¼ã‚¸ (rb_miss_countã¯æ‰‹å‹•å…¥åŠ›ã‚’æ´»ã‹ã™ãŸã‚ã€ãã®ã¾ã¾æ®‹ã™)
      const parsedMetrics = parseMetricsFromText($("text").value||"");
      state.metrics.games = parsedMetrics.games;
      state.metrics.bell = parsedMetrics.bell;
      state.metrics.cherry = parsedMetrics.cherry;
      state.metrics.ice = parsedMetrics.ice;

      if(!toNum(state.metrics.games)){
        setError("ç·Gï¼ˆä¾‹: 6,056Gï¼‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
      }else{
        const got=["bell","cherry","ice"].filter(k=>toNum(state.metrics[k])!=null);
        if(got.length===0) setError("ã€é¢¨éˆ´åˆç®—ï¼ãƒã‚§ãƒªãƒ¼åˆç®—ï¼æ°·åˆç®—ã€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
      }
      renderMetrics(false); renderBars();
    }catch(err){ setError("è§£æä¸­ã«ã‚¨ãƒ©ãƒ¼: "+(err && err.message ? err.message : String(err))); }
  });

  $("edit-mode").addEventListener("change",(e)=>{ state.flags.edit = e.target.checked; renderMetrics(false); });
  $("peace").addEventListener("change",(e)=>{ state.flags.peace = e.target.checked; renderBars(); });
  $("yohaku-hazure").addEventListener("change",(e)=>{ state.flags.yohakuHazure = e.target.checked; updateSignals(state.extra); renderBars(); });

  // ãƒ‡ãƒ¢ç”¨è‡ªå·±ãƒ†ã‚¹ãƒˆï¼ˆåˆæœŸãƒ‡ãƒ¼ã‚¿æŒ¿å…¥ï¼‰
  const sample = `æ–°ãƒãƒŠãƒ“
ç·ãƒ—ãƒ¬ã‚¤æ•°
å°å½¹
é¢¨éˆ´
åˆç®—
æ°·
åˆç®—
ãƒã‚§ãƒªãƒ¼
åˆç®—
BBä¸­è©³ç´°
é¢¨éˆ´ä¸­æ®µæƒ
é¢¨æ–œã‚æƒã„
ãƒ¬ã‚¢å½¹
RT
èŠ±ç«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ä¸­
ã¯ãšã‚Œ
èŠ±ç«GAMEä¸­
ã¯ãšã‚Œ
ç·ãƒœãƒ¼ãƒŠã‚¹
ç·BB
ãƒ‰ãƒ³BB
èµ¤ä¸ƒBB
RB
6,056G
46å›
1/131.7
35å›
1/173.0
16å›
1/378.5
19å›
1/318.7
11å›
1/550.5
813å›
1/7.4
103å›
1/58.8
393å›
1/15.4
910å›
1/1.1
103å›
1/9.8
1å›
1/1,014.0
83å›
1/6.1
42å›
1/13.0
1æšå½¹
8å›
1/12.0
äºˆå‘ŠéŸ³æ°·
1/24.0
RBä¸­è©³ç´°(å¤©ã®ä»–)
ãƒã‚ºãƒ¬
0å›`;
  const parsedMetrics = parseMetricsFromText(sample);
  state.metrics.games = parsedMetrics.games;
  state.metrics.bell = parsedMetrics.bell;
  state.metrics.cherry = parsedMetrics.cherry;
  state.metrics.ice = parsedMetrics.ice;
  state.metrics.rb_miss_count = 0; // ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦0å›ã‚’ã‚»ãƒƒãƒˆ

  renderMetrics(false); renderBars();
}
init();
</script>
</body>
</html>
